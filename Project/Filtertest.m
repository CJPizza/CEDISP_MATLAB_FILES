clc;
clear all;


fs = 11025;
bpm = 60;

%------------------------------------------------------------------------------------------------------
% CHORUS - 1

% Soprano Pa
Pa(1:2) = struct('noteNumbers', {40, 40}, 'durations', {0.5, 0.5}, 'startPulses', {0, 0});

% Alto Pa
Pa(3:4) = struct('noteNumbers', {40, 40}, 'durations', {0.5, 0.5}, 'startPulses', {0,0});

% Tenor Pa
Pa(5:6) = struct('noteNumbers', {52, 52}, 'durations', {0.5, 0.5}, 'startPulses', {0,0});

% Bass Pa
Pa(7:8) = struct('noteNumbers', {40, 40}, 'durations', {0.5, 0.5}, 'startPulses', {0,0});

 for i=1:8
     Papuri(i).noteNumbers = Pa(i).noteNumbers;
     Papuri(i).durations = Pa(i).durations;
     Papuri(i).startPulses = Pa(i).startPulses;
 end
% Soprano 1
Chorus(1).noteNumbers   = [45 47 40 51 49 47 49 45 54 52 51 52 49 45 47 49 51 47 40 45 47 40 51 49 47 49 45 54 52 51 52 45 52 45 52 52];
Chorus(1).durations     = [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5 0.5 0.5 1.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 1] ;
Chorus(1).startPulses =   [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 6 6.5 7 7.5 8 8.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5] ;

% Soprano 2
Chorus(2).noteNumbers   = [45 47 40 51 49 47 49 45 54 52 51 52 49 45 47 49 51 47 40 45 47 40 51 49 47 49 45 54 52 51 52 45 52 45 52 52];
Chorus(2).durations     = [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5 0.5 0.5 1.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 1] ;
Chorus(2).startPulses =   [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 6 6.5 7 7.5 8 8.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5] ;

% Alto
Chorus(3).noteNumbers =   [40 40 40 45 45 45 47 45 51 45 45 47 45 44 42 40 47 45 45 44 40 40 40 40 45 45 45 47 45 51 45 45 47 45 45 42 45 44 ];
Chorus(3).durations =     [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.25 0.25 0.5 0.5 0.5 1 0.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 1 ];
Chorus(3).startPulses =   [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 6 6.5 6.75 7 7.5 8 8.5 9.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5];

% Alto
Chorus(4).noteNumbers =   [40 40 40 45 45 45 47 45 51 45 45 47 45 44 42 40 47 45 45 44 40 40 40 40 45 45 45 47 45 51 45 45 47 45 45 42 45 44];
Chorus(4).durations =     [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.25 0.25 0.5 0.5 0.5 1 0.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 1 ];
Chorus(4).startPulses =   [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 6 6.5 6.75 7 7.5 8 8.5 9.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5];

% Tenor
Chorus(5).noteNumbers   = [49 47 47 51 52 51 52 52 57 57 57 52 52 49 47 52 54 54 52 52 49 47 47 51 52 51 52 52 57 57 57 52 57 54 51 54 52 51 ];
Chorus(5).durations     = [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5 0.5 0.5 1 0.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 0.5 0.5];
Chorus(5).startPulses   = [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 6 6.5 7 7.5 8 8.5 9.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5 20];

% Tenor
Chorus(6).noteNumbers   = [49 47 47 51 52 51 52 52 57 57 57 52 52 49 47 52 54 54 52 52 49 47 47 51 52 51 52 52 57 57 57 52 57 52 51 54 52 51];
Chorus(6).durations     = [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5 0.5 0.5 1 0.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 0.5 0.5];
Chorus(6).startPulses   = [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 6 6.5 7 7.5 8 8.5 9.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5 20];

% Bass
Chorus(7).noteNumbers   = [33 32 32 30 30 30 28 40 39 37 35 37 35 33 32 30 32 33 27 35 40 33 32 32 30 30 30 28 40 39 37 35 37 33 35 35 35 35];
Chorus(7).durations     = [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.25 0.25 0.25 0.25 0.5 0.5 0.5 0.5 1.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 1];
Chorus(7).startPulses   = [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 5.75 6 6.25 6.5 7 7.5 8 8.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5];

%Bass
Chorus(8).noteNumbers   = [33 32 32 30 30 30 28 40 39 37 35 37 35 33 32 30 32 33 27 28 40 33 32 32 30 30 30 28 40 39 37 35 37 33 35 23 28 28];
Chorus(8).durations     = [1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.25 0.25 0.25 0.25 0.5 0.5 0.5 0.5 1.5 0.5 1 0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.25 0.25 0.5 0.5 1.5 0.5 1 1];
Chorus(8).startPulses   = [0.5 1.5 2 2.5 3 3.25 3.5 4 4.5 5 5.25 5.5 5.75 6 6.25 6.5 7 7.5 8 8.5 10 10.5 11.5 12 12.5 13 13.25 13.5 14 14.5 15 15.25 15.5 16 16.5 18 18.5 19.5];

for i = 1:8
    Papuri(i).noteNumbers = [Papuri(i).noteNumbers,Chorus(i).noteNumbers];
    Papuri(i).durations = [Papuri(i).durations,Chorus(i).durations];
    Papuri(i).startPulses = [Papuri(i).startPulses,Chorus(i).startPulses];

end

%------------------------------------------------------------------------------------------------------
% P1 

% Soprano san
San(1:2) = struct('noteNumbers', {[45, 0], [45, 0]}, 'durations', {[1.5, 0.5], [1.5, 0.5]}, 'startPulses', {[0, 1.5]+20.5, [0, 1.5]+20.5});

% Alto san
San(3:4) = struct('noteNumbers', {[40, 0], [40, 0]}, 'durations', {[1.5, 0.5], [1.5, 0.5]}, 'startPulses', {[0, 1.5]+20.5, [0, 1.5]+20.5});

% Tenor san
San(5:6) = struct('noteNumbers', {[49, 0], [49, 0]}, 'durations', {[1.5, 0.5], [1.5, 0.5]}, 'startPulses', {[0, 1.5]+20.5, [0,1.5]+20.5});

% Bass san
San(7:8) = struct('noteNumbers', {[33, 0], [33, 0]}, 'durations', {[1.5, 0.5], [1.5, 0.5]}, 'startPulses', {[0, 1.5]+20.5, [0, 1.5]+20.5});


%SATB
P1.noteNumbers   = [45 45 40 40 45 45 45 40 40 45 45 47 49 45 45 47 49 51 49 45 47 47 40 40 52 52 52 51 44 44 52 52 52 52 51 44 44 49 47 44 40 45 44 42 47 52 51 51 51 54 52 52 52 56 56 56 54 54 54 57 56 56 56 56 56 56 56 49 49 56 49 49 51 52 52 40];
P1.durations     = [0.5 0.5 0.5 0.5  0.5 0.25 0.25 0.5 0.5  0.5 0.25 0.25 0.5 0.5  1 0.5 0.5  0.25 0.25 0.5 1 0.5 0.25 0.25 0.5 0.25 0.25  0.5 0.25 0.25 0.25 0.25 0.25 0.25  0.5 0.25 0.25 0.5 0.5  0.5 0.5 0.5 0.5  0.5 0.5 1 0.5 0.25 0.25 1  0.5 0.25 0.25 0.5 0.25 0.25  0.5 0.25 0.25 1  0.5 0.5 0.5 0.25 0.25  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.5 1 0.5 0.5] ;
P1.startPulses   = [2 2.5 3 3.5 4 4.5 4.75 5 5.5 6 6.5 6.75 7 7.5 8 9 9.5 10 10.25 10.5 11 12 12.5 12.75 13 13.5 13.75 14 14.5 14.75 15 15.25 15.5 15.75 16 16.5 16.75 17 17.5 18 18.5 19 19.5 20 20.5 21 22 22.5 22.75 23 24 24.5 24.75 25 25.5 25.75 26 26.5 26.75 27 28 28.5 29 29.5 29.75 30 30.5 31 31.5 32 32.5 33 33.5 34 35 35.5] + 20.5;

for i = 1:8
    Papuri(i).noteNumbers = [Papuri(i).noteNumbers,San(i).noteNumbers,P1(1).noteNumbers,Chorus(i).noteNumbers];
    Papuri(i).durations = [Papuri(i).durations,San(i).durations,P1(1).durations,Chorus(i).durations];
    Papuri(i).startPulses = [Papuri(i).startPulses,San(i).startPulses,P1(1).startPulses,Chorus(i).startPulses+56];

end


  %------------------------------------------------------------------------------------------------------
  % P2
    
    %SATB
    P2.noteNumbers   = [45 0 40 40  45 45 47  51 49 47 49 45  49 49 51 51 51  54 54 52 45 54 54 52 52 52 52 52 52 52 52  52 45 45 45  50 51 51  52 52 52 52 52 50 51 51 49 51  52 52 47  52 52  54 54 52  52 52 40];
    P2.durations     = [1 0.5 0.25 0.25  0.5 0.5 1  0.5 0.25 0.25 0.5 0.5  0.5 0.5 0.5 0.25 0.25  0.5 0.5 0.5 0.5 0.75 0.25 0.5 0.25 0.25  0.5 0.5 0.5 0.25 0.25  0.5 0.5 0.5 0.5  1 0.75 0.25  0.5 0.25 0.25 0.5 0.5 0.5 0.5 0.5 0.25 0.25  1 0.75 0.25  1 1  1 0.75 0.25  1 0.5 0.5] ;
    P2.startPulses   = [0 1 1.5 1.75 2 2.5 3 4 4.5 4.75 5 5.5 6 6.5 7 7.5 7.75 8 8.5 9 9.5 10 10.75 11 11.5 11.75 12 12.5 13 13.5 13.75 14 14.5 15 15.5 16 17 17.75 18 18.5 18.75 19 19.5 20 20.5 21 21.5 21.75 22 23 23.75 24 25 26 27 27.75 28 29 29.5] + 76.5;

  for i = 1:8
      Papuri(i).noteNumbers = [Papuri(i).noteNumbers,P2.noteNumbers,Chorus(i).noteNumbers];
      Papuri(i).durations = [Papuri(i).durations,P2.durations,Chorus(i).durations];
      Papuri(i).startPulses = [Papuri(i).startPulses,P2.startPulses,Chorus(i).startPulses + 106];
  end

  %------------------------------------------------------------------------------------------------------
  % P3
  
  % P3 San
  for i = 1:8
      P3_san(i).noteNumbers = [45 0];
      P3_san(i).durations = [1.5 0.5];
      P3_san(i).startPulses = [0 1.5] + 126.5;
  end 
  %SATB
  P3_piano.noteNumbers   = [0 49 51 49 45  47 52  0 49 51 49 45  47  0 61 63 61 57  59 64  0 61 63 61 57];
  P3_piano.durations     = [1 0.5 0.5 0.5 0.5  1 2  1 0.5 0.5 0.5 0.5  3  1 0.5 0.5 0.5 0.5  1 2  1 0.5 0.5 0.5 0.5] ;
  P3_piano.startPulses   = [0 1 1.5 2 2.5 3 4 6 7 7.5 8 8.5 9 12 13 13.5 14 14.5 15 16 18 19 19.5 20 20.5];
 
  % Soprano 1
  P3(1).noteNumbers   = [49 0  52  54  56  57  56  54  52  52 49 ]; 
  P3(1).durations     = [2  1  3    3  3   3   3   3   3  2   1 ]; 
  P3(1).startPulses =   [21 23 24 27 30 33 36 39 42 45 47 ];

  % Soprano 2
  P3(2).noteNumbers   = [49 0  52  54  56  57  56  54  52  52 49];
  P3(2).durations     = [2 1  3  3  3  3  3  3  3  2 1 ]; 
  P3(2).startPulses =   [21 23 24 27 30 33 36 39 42 45 47 ]; 

  % Alto
  P3(3).noteNumbers   = [0 45 47 49 47 49 47 45 44 49 ];
  P3(3).durations     = [3  3  3  3  3  3  3  3  2 1];
  P3(3).startPulses =   [21 24 27 30  33 36 39 42 45 47];

  % Alto
  P3(4).noteNumbers   = [0 45 47 49 52 54 52 49 47 49];
  P3(4).durations     = [3  3  3  3  3  3  3  3  2 1 ];
  P3(4).startPulses =   [21 24 27 30  33 36 39 42 45 47];

  % Tenor
  P3(5).noteNumbers   = [0  56  56  57  56  57  56  54  52  49 ];
  P3(5).durations     = [3  3  3  3  3  3  3  3  2 1 ];
  P3(5).startPulses =   [21 24 27 30 33 36 39 42 45 47 ];

  % Tenor
  P3(6).noteNumbers   = [0  54  52  54  52  54  52 54  52  49];
  P3(6).durations     = [3  3  3  3  3  3  3  3  2 1];
  P3(6).startPulses =   [21 24 27 30 33 36 39 42 45 47 ];

  % Bass
  P3(7).noteNumbers   = [0 30  37 37  35 37 39  37 33 32  32 33 35  37 37 37  42 40  42  37  37 37 ];
  P3(7).durations     = [2 1  2 1  1 1 1  2 0.5 0.5  1 1 1  1 1 1  1 1 1  3  2 1];
  P3(7).startPulses =   [21 23 24 26 27 28 29 30 32 32.5 33 34 35 36 37 38 39 40 41 42 45 47 ];

  %Bass
  P3(8).noteNumbers   = [0 30  37 37  35 37 39  37 33 32  32 33 35  37 37 37  42 40  42  37  37 37 ];
  P3(8).durations     = [2 1  2 1  1 1 1  2 0.5 0.5  1 1 1  1 1 1  1 1 1  3  2 1 ];
  P3(8).startPulses =   [21 23 24 26 27 28 29 30 32 32.5 33 34 35 36 37 38 39 40 41 42 45 47];

  % ------------------------------------------------------------------ 
  % Soprano 1
  P3a(1).noteNumbers   = [54 54 52 45 51 52 51 49 42 47 47 45 42 44 45 44 42 42];
  P3a(1).durations     = [2 1 2 1 1.5 0.5 1 2 1 2 1 2 1 1.5 0.5 1 3 3] ;
  P3a(1).startPulses =   [48 50 51 53 54 55.5 56 57 59 60 62 63 65 66 67.5 68 69 72] ;

  % Soprano 2
  P3a(2).noteNumbers   = [54 54 52 45 51 52 51 49 42 47 47 45 42 44 45 44 42 42] ;
  P3a(2).durations     = [2 1 2 1 1.5 0.5 1 2 1 2 1 2 1 1.5 0.5 1 3 3] ;
  P3a(2).startPulses =   [48 50 51 53 54 55.5 56 57 59 60 62 63 65 66 67.5 68 69 72] ;

  % Alto
  P3a(3).noteNumbers   = [52 51 49 47 45 45 47 49 47 45 42 42 42 42 42 40 37 37];
  P3a(3).durations     = [1 1 1  1 1 1  1.5 0.5 1  2 1  2 1  2 1  3  3  3] ;
  P3a(3).startPulses =   [48 49 50 51 52 53 54 55.5 56 57 59 60 62 63 65 66 69 72] ;

  % Alto
  P3a(4).noteNumbers   = [52 51 49 47 45 45 47 49 47 45 42 42 42 42 42 40 37 37];
  P3a(4).durations     = [1 1 1  1 1 1  1.5 0.5 1  2 1  2 1  2 1  3  3  3] ;
  P3a(4).startPulses =   [48 49 50 51 52 53 54 55.5 56 57 59 60 62 63 65 66 69 72] ;

  % Tenor
  P3a(5).noteNumbers   = [59 59  54 54  56 54 52  56 54 54  51 51  49 49  49  45  45];
  P3a(5).durations     = [2 1  2 1  1.5 0.5 1  1 1 1  2 1  2 1  3  3  3] ;
  P3a(5).startPulses =   [48 50 51 53 54 55.5 56 57 58 59 60 62 63 65 66 69 72] ;

  % Tenor
  P3a(6).noteNumbers   = [59 59  54 54  56 54 52  56 54 54  51 51  49 49 47 45  45];
  P3a(6).durations     = [2 1  2 1  1.5 0.5 1  1 1 1  2 1  2 1  3  3  3] ;
  P3a(6).startPulses =   [48 50 51 53 54 55.5 56 57 58 59 60 62 63 65 66 69 72] ;

  % Bass
  P3a(7).noteNumbers   = [39 39  37 37  35 33 32  30 30 25 25  25 25  25  30  30];
  P3a(7).durations     = [2 1  2 1  1.5 0.5 1  2 1  2 1  2 1  3  3  3] ;
  P3a(7).startPulses =   [48 50 51 53 54 55.5 56 57 59 60 62 63 65 66 69 72] ;

  %Bass
  P3a(8).noteNumbers   = [39 39  37 37  35 33 32  30 30 35 35  33 33  25  30  30];
  P3a(8).durations     = [2 1  2 1  1.5 0.5 1  2 1  2 1  2 1  3  3  3] ;
  P3a(8).startPulses =   [48 50 51 53 54 55.5 56 57 59 60 62 63 65 66 69 72] ;



  
  %------------------------------------------------------------------------------------------------------
  
  % Soprano 1
  P3b(1).noteNumbers   = [0 49 51 49 45 47 0  49  52  54  56  57  56 54  49 42 42  49 49  47 51  49 49 42  44 45 47 42  49 49  48 49 50];
  P3b(1).durations     = [1 0.5 0.5 0.5 0.5 2 1  3  3  3  3  3  3 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(1).startPulses =   [75 76 76.5 77 77.5 78 80 81 84 87 90 93 96 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;

  % Soprano 2
  P3b(2).noteNumbers   = [0 49 51 49 45 47 0  49  52  54  56  57  56 54  49 42 42  49 49  47 51  49 49 42  44 45 47 42  49 49  48 49 50] ;
  P3b(2).durations     = [1 0.5 0.5 0.5 0.5 2 1  3  3  3  3  3  3 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(2).startPulses =   [75 76 76.5 77 77.7 78 80 81 84 87 90 93 96 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;

  % Alto
  P3b(3).noteNumbers   = [0 0 45 47 49 47 49 47 45 45 42 42 49 49 47 51 49 49 42 44 45 47 42 49 49 47 49 51];
  P3b(3).durations     = [3  3  3  3  3  3  3  3 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(3).startPulses =   [75 78 81 84 87 90 93 96 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;

  % Alto
  P3b(4).noteNumbers   = [0 0 45 47 49 52 54 52 49 45 42 42 49 49 47 51 49 49 42 44 45 47 42 49 49 47 49 51];
  P3b(4).durations     = [3  3  3  3  3  3  3  3 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(4).startPulses =   [75 78 81 84 87 90 93 96 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;

  % Tenor
  P3b(5).noteNumbers   = [0  0  56  56  57  56  57  56 54  54 42 42  49 49  47 51  49 49 43  44 45 47 42  49 49  47 49 51];
  P3b(5).durations     = [3  3  3  3  3  3  3  3 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(5).startPulses =   [75 78 81 84 87 90 93 96 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;

  % Tenor
  P3b(6).noteNumbers   = [0  0  56  56  57  56  57  56 54  54 42 42  49 49  47 51  49 49 43  44 45 47 42  49 49  47 49 51];
  P3b(6).durations     = [3  3  3  3  3  3  3  3 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(6).startPulses =   [75 78 81 84 87 90 93 96 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;

  % Bass
  P3b(7).noteNumbers   = [0  0 30  37 37  35 37 39  37 33 32  32 33 35  37 37 37  42 40 42 37  37 30 30  37 37  35 39  37 37 30  32 33 35 30  37 37  35 37 39];
  P3b(7).durations     = [3  2 1  2 1  1 1 1  2 0.5 0.5  1 1 1  1 1 1  1 1 1 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(7).startPulses =   [75 78 80 81 83 84 85 86 87 89 89.5 90 91 92 93 94 95 96 97 98 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;

  %Bass
  P3b(8).noteNumbers   = [0  0 30  37 37  35 37 39  37 33 32  32 33 35  37 37 37  42 40 42 37  37 30 30  37 37  35 39  37 37 30  32 33 35 30  37 37  35 37 39];
  P3b(8).durations     = [3  2 1  2 1  1 1 1  2 0.5 0.5  1 1 1  1 1 1  1 1 1 3  2 0.5 0.5  2 1  2 1  2 0.5 0.5  0.5 0.5 1.5 0.5  2 1  1 1 1] ;
  P3b(8).startPulses =   [75 78 80 81 83 84 85 86 87 89 89.5 90 91 92 93 94 95 96 97 98 99 102 104 104.5 105 107 108 110 111 113 113.5 114 114.5 115 116.5 117 119 120 121 122] ;
  


  %------------------------------------------------------------------------------------------------------
  
  % Soprano 1
  P3c(1).noteNumbers   = [52 52  49 49 50 53  54  54 49  54 54  52 45  51 52 51  49 42 47 47  45 42  44 45 44  42  0 40];
  P3c(1).durations     = [2 1  0.5 0.5 1 0.5  3  2 1  2 1  2 1  1.5 0.5 1  2 1 2 1  2 1  1.5 0.5 1  3  2 1];
  P3c(1).startPulses =   [123 125 126 126.5 127 128.5 129 132 134 135 137 138 140 141 142.5 143 144 146 147 149 150 152 153 154.5 155 156 159 161];

  % Soprano 2
  P3c(2).noteNumbers   = [52 52  49 49 50 53  54  54 49  54 54  52 45  51 52 51  49 42 47 47  45 42  44 45 44  42  0 40];
  P3c(2).durations     = [2 1  0.5 0.5 1 0.5  3  2 1  2 1  2 1  1.5 0.5 1  2 1 2 1  2 1  1.5 0.5 1  3  2 1];
  P3c(2).startPulses =   [123 125 126 126.5 127 128.5 129 132 134 135 137 138 140 141 142.5 143 144 146 147 149 150 152 153 154.5 155 156 159 161];

  % Alto
  P3c(3).noteNumbers   = [52 52 44 44 45 47 45 45 49 52 51 49 47 49 49 47 49 47 45 42 42 42 42 42 40 37 0 40];
  P3c(3).durations     = [2 1  0.5 0.5 1 1  3  2 1  1 1 1  1 1 1  1.5 0.5 1  2 1 2 1  2 1  3  3  2 1];
  P3c(3).startPulses =   [123 125 126 126.5 127 128 129 132 134 135 136 137 138 139 140 141 142.5 143 144 146 147 149 150 152 153 156 159 161];

  % Alto
  P3c(4).noteNumbers   = [52 52 44 44 45 47 49 49 49 52 51 49 47 49 49 47 49 47 45 42 42 42 42 42 40 37 0 40];
  P3c(4).durations     = [2 1  0.5 0.5 1 1  3  2 1  1 1 1  1 1 1  1.5 0.5 1  2 1 2 1  2 1  3  3  2 1];
  P3c(4).startPulses =   [123 125 126 126.5 127 128 129 132 134 135 136 137 138 139 140 141 142.5 143 144 146 147 149 150 152 153 156 159 161];

  % Tenor
  P3c(5).noteNumbers   = [52 52  52 52 54 56  54  54 49  57 57  52 52  54 52 54  56 54 54 51 51  49 49  49  45  0 52];
  P3c(5).durations     = [2 1  0.5 0.5 1 1  3  2 1  2 1  2 1  1.5 0.5 1  1 1 1 2 1  2 1  3  3  2 1];
  P3c(5).startPulses =   [123 125 126 126.5 127 128 129 132 134 135 137 138 140 141 142.5 143 144 145 146 147 149 150 152 153 156 159 161];

  % Tenor
  P3c(6).noteNumbers   = [52 52  52 52 54 56  49  49 49  57 57  52 52  54 52 54  56 54 54 51 51  49 49  47  45  0 52];
  P3c(6).durations     = [2 1  0.5 0.5 1 1  3  2 1  2 1  2 1  1.5 0.5 1  1 1 1 2 1  2 1  3  3  2 1];
  P3c(6).startPulses =   [123 125 126 126.5 127 128 129 132 134 135 137 138 140 141 142.5 143 144 145 146 147 149 150 152 153 156 159 161];

  % Bass
  P3c(7).noteNumbers   = [40 40  37 35 33 32  30  28 37  39 39  37 37  35 33 32  30 30 25 25  25 25  25  30  0 40];
  P3c(7).durations     = [2 1  0.5 0.5 1 1  3  2 1  2 1  2 1  1.5 0.5 1  2 1 2 1  2 1  3  3  2 1];
  P3c(7).startPulses =   [123 125 126 126.5 127 128 129 132 134 135 137 138 140 141 142.5 143 144 146 147 149 150 152 153 156 159 161];

  %Bass
  P3c(8).noteNumbers   = [40 40  37 35 33 32  30  28 37  39 39  37 37  35 33 32  30 30 35 35  33 33 25  30  0 40];
  P3c(8).durations     = [2 1  0.5 0.5 1 1  3  2 1  2 1  2 1  1.5 0.5 1  2 1 2 1  2 1  3  3  2 1];
  P3c(8).startPulses =   [123 125 126 126.5 127 128 129 132 134 135 137 138 140 141 142.5 143 144 146 147 149 150 152 153 156 159 161];

  for i = 1:8
      Papuri(i).noteNumbers =   [Papuri(i).noteNumbers,   P3_san(i).noteNumbers,   P3_piano.noteNumbers,         P3(i).noteNumbers,       P3a(i).noteNumbers,        P3b(i).noteNumbers,      P3c(i).noteNumbers,       Chorus(i).noteNumbers];
      Papuri(i).durations =     [Papuri(i).durations,     P3_san(i).durations,     P3_piano.durations,           P3(i).durations,         P3a(i).durations,          P3b(i).durations,        P3c(i).durations,         Chorus(i).durations];
      Papuri(i).startPulses =   [Papuri(i).startPulses,   P3_san(i).startPulses,   P3_piano.startPulses+ 128 ,   P3(i).startPulses+128,   P3a(i).startPulses+128,    P3b(i).startPulses+128,  P3c(i).startPulses+128,   Chorus(i).startPulses+289];
      
  
  end


  
  %------------------------------------------------------------------------------------------------------
  % P4

  % Soprano san
  P4_san(1:2) = struct('noteNumbers', {[45 0 45 45], [45 0 45 45]}, 'durations', {[1  0.5 0.25 0.25], [1  0.5 0.25 0.25]}, 'startPulses', {[0 1 1.5 1.75]+ 309.5, [0 1 1.5 1.75]+ 309.5});

  % Alto san
  P4_san(3:4) = struct('noteNumbers', {[40, 0], [40, 0]}, 'durations', {[1 1], [1 1]}, 'startPulses', {[0, 1]+ 309.5, [0, 1]+ 309.5});

  % Tenor san
  P4_san(5:6) = struct('noteNumbers', {[49, 0], [49, 0]}, 'durations', {[1 1], [1 1]}, 'startPulses', {[0, 1]+ 309.5, [0,1]+ 309.5});

  % Bass san
  P4_san(7:8) = struct('noteNumbers', {[33, 0], [33, 0]}, 'durations', {[1 1], [1 1]}, 'startPulses', {[0, 1]+ 309.5, [0, 1]+ 309.5});


  P4_unison.noteNumbers   = [52 52 52  45 45 45  54 52 51  52 52 45  57 56 52  54 52 51 52 45 45  51 49 47 47 45 45 52 52 52  52 52 52 52 52  45 45 45 45  54 52 51  52 52 45  57 57 56 54 52 51 52 45  51 49 47 45  52 52 52 45  52 52 52 52  45 45 40];
  P4_unison.durations     = [0.75 0.25 1  0.5 0.5 1  1 0.75 0.25  1 0.5 0.5  1 0.5 0.5  0.5 0.25 0.25 0.5 0.25 0.25  0.5 0.5 0.25 0.25 0.25 0.25 0.5 0.5 1  0.5 0.25 0.25 0.75 0.25  0.5 0.5 0.5 0.5  1 0.75 0.25  1 0.5 0.5  0.5 0.5 1 0.5 0.25 0.25 0.5 0.5  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.5  0.75 0.25 0.75 0.25  1 0.5 0.5];
  P4_unison.startPulses   = [2 2.75 3 4 4.5 5 6 7 7.75 8 9 9.5 10 11 11.5 12 12.5 12.75 13 13.5 13.75 14 14.5 15 15.25 15.5 15.75 16 16.5 17 18 18.5 18.75 19 19.75 20 20.5 21 21.5 22 23 23.75 24 25 25.5 26 26.5 27 28 28.5 28.75 29 29.5 30 30.5 31 31.5 32 32.5 33 33.5 34 34.75 35 35.75 36 37 37.5]+309.5;



 for i=1:8
     Papuri(i).noteNumbers =    [Papuri(i).noteNumbers,     P4_san(i).noteNumbers,          P4_unison.noteNumbers,  Chorus(i).noteNumbers];
     Papuri(i).durations =      [Papuri(i).durations,       P4_san(i).durations,            P4_unison.durations,    Chorus(i).durations];
     Papuri(i).startPulses =    [Papuri(i).startPulses,     P4_san(i).startPulses ,         P4_unison.startPulses,  Chorus(i).startPulses + 347];
 end

  %------------------------------------------------------------------------------------------------------
  % P5
  % Soprano 1
  P5(1).noteNumbers   = [45 0  0 52 57 52  0 54 52 52 52 54 56 57 59  57 59  61];
  P5(1).durations     = [1 1  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5  1 1  2];
  P5(1).startPulses =   [0 1 2 2.5 3 3.5 4 4.5 5 5.5 5.875 6 6.5 7 7.5 8 9 10];

  % Soprano 2
  P5(2).noteNumbers   = [45 0  0 52 57 52  0 51 49 49 49 51 52 52 52  54 56  57];
  P5(2).durations     = [1 1  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5  1 1  2];
  P5(2).startPulses =   [0 1 2 2.5 3 3.5 4 4.5 5 5.5 5.875 6 6.5 7 7.5 8 9 10];

  % Alto
  P5(3).noteNumbers   = [40 0 49 52 45 45 52 52 45 52 52 45 52 52 49];
  P5(3).durations     = [1 0.5 0.5  1 0.5 0.5  1 0.5 0.5 1 0.5 0.5  1 1  2];
  P5(3).startPulses =   [0 1 1.5 2 3 3.5 4 5 5.5 6 7 7.5 8 9 10];

  % Alto
  P5(4).noteNumbers   = [40 0 49 52 45 45 52 52 45 52 52 45 52 52 52];
  P5(4).durations     = [1 0.5 0.5  1 0.5 0.5  1 0.5 0.5 1 0.5 0.5  1 1  2];
  P5(4).startPulses =   [0 1 1.5 2 3 3.5 4 5 5.5 6 7 7.5 8 9 10];

  % Tenor
  P5(5).noteNumbers   = [49 0  0 61 57 57 0 57 57 57 57 57 57 57 57  57 59  57];
  P5(5).durations     = [1 1  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5  1 1  2];
  P5(5).startPulses =   [0 1 2 2.5 3 3.5 4 4.5 5 5.5 5.875 6 6.5 7 7.5 8 9 10];

  % Tenor
  P5(6).noteNumbers   = [49 0  0 57 56 56 0 54 56 56 56 54 54 52 52  54 56  52];
  P5(6).durations     = [1 1  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5  1 1  2];
  P5(6).startPulses =   [0 1 2 2.5 3 3.5 4 4.5 5 5.5 5.875 6 6.5 7 7.5 8 9 10];

  % Bass
  P5(7).noteNumbers   = [33 0  0 40 40 40  0 40 40 40 40 39 39 37 37  35 40  33];
  P5(7).durations     = [1 1  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5  1 1  2];
  P5(7).startPulses =   [0 1 2 2.5 3 3.5 4 4.5 5 5.5 5.875 6 6.5 7 7.5 8 9 10];

  %Bass
  P5(8).noteNumbers   = [33 0  0 40 40 40  0 40 40 40 40 39 39 37 37  37 40  33];
  P5(8).durations     = [1 1  0.5 0.5 0.5 0.5  0.5 0.5 0.5 0.25 0.25 0.5 0.5 0.5 0.5  1 1  2];
  P5(8).startPulses =   [0 1 2 2.5 3 3.5 4 4.5 5 5.5 5.875 6 6.5 7 7.5 8 9 10];

  for i = 1:8
      Papuri(i).noteNumbers =    [Papuri(i).noteNumbers,     P5(i).noteNumbers];
      Papuri(i).durations =      [Papuri(i).durations,       P5(i).durations];
      Papuri(i).startPulses =    [Papuri(i).startPulses,     P5(i).startPulses + 367.5];
  end
  %------------------------------------------------------------------------------------------------------
  
  S = toSound(Papuri(1:2),fs,bpm);
  A = toSound(Papuri(3:4),fs,bpm);
  T = toSound(Papuri(5:6),fs,bpm);
  B = toSound(Papuri(7:8),fs,bpm);

  SATB = S + A + T + B;
% --------------FILTERS----------------

% LOWPASS FILTER

% Soprano
[b, a] = butter(3, 775 / (fs / 2), 'low');
S_filtered = filter(b, a, S);

% Alto
[d, c] = butter(3, 700 / (fs / 2), 'low');
A_filtered = filter(d, c, A);

% Tenor
[f, e] = butter(3, 600 / (fs / 2), 'low');
T_filtered = filter(f, e, T);


% BANDPASS FILTER

bandpassParams = [
    struct('fc_low', 260, 'fc_high', 885, 'order', 3),  % Soprano
    struct('fc_low', 175, 'fc_high', 700, 'order', 3),  % Alto
    struct('fc_low', 130, 'fc_high', 530, 'order', 3),  % Tenor
    struct('fc_low', 60, 'fc_high', 250, 'order', 3)   % Bass
];

S_filtereda = bandpass(S_filtered, bandpassParams(1).fc_low, bandpassParams(1).fc_high, bandpassParams(1).order, fs);
A_filtereda = bandpass(A_filtered, bandpassParams(2).fc_low, bandpassParams(2).fc_high, bandpassParams(2).order, fs);
T_filtereda = bandpass(T_filtered, bandpassParams(3).fc_low, bandpassParams(3).fc_high, bandpassParams(3).order, fs);
B_filtereda = bandpass(B, bandpassParams(4).fc_low, bandpassParams(4).fc_high, bandpassParams(4).order, fs);

xxF = S_filtereda + A_filtereda + T_filtereda + B_filtereda; % Bandpass filtered

%soundsc(xxF, fs);

%audiowrite('test.wav', xxF/max(abs(xxF)), fs);

% ---------------PLOTS----------------

figure;
subplot(2,1,1)
spectrogram(SATB, 1024, [], 1024, fs, 'yaxis');
title('Unfiltered')

subplot(2,1,2)
spectrogram(xxF, 1024, [], 1024, fs, 'yaxis');
title('Filtered')


figure;

subplot(2, 2, 1);
spectrogram(S_filtereda, 1024, [], 1024, fs, 'yaxis');
colorbar;
title('Filtered Soprano');

subplot(2, 2, 2);
spectrogram(A_filtereda, 1024, [], 1024, fs, 'yaxis');
colorbar;
title('Filtered Alto');

subplot(2, 2, 3);
spectrogram(T_filtereda, 1024, [], 1024, fs, 'yaxis');
colorbar;
title('Filtered Tenor');

subplot(2, 2, 4);
spectrogram(B_filtereda, 1024, [], 1024, fs, 'yaxis');
colorbar;
title('Filtered Bass');


